{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash
# mise config hash: {{ include "dot_config/mise/config.toml.tmpl" | sha256sum }}-{{ .mise | toJson | sha256sum }}
set -euo pipefail

eval "$(/opt/homebrew/bin/brew shellenv)"

{{- $hasPython := and (has "python" .mise.tools) (not (has "python" .mise.exclude)) }}
{{- $hasGcloud := and (has "gcloud" .mise.tools) (not (has "gcloud" .mise.exclude)) }}

{{ if $hasPython }}
# Install Python first (required by gcloud)
mise install python --yes
{{ if $hasGcloud }}
# Ensure gcloud uses mise Python during installation (not system Python 3.9)
export CLOUDSDK_PYTHON="$(mise which python)"
{{ end }}
{{ end }}

# Install remaining tools
mise install --yes
{{ end -}}
